#!/bin/bash

##############################################################################
#
#   Gradle start up script for POSIX generated by Gradle.
#
##############################################################################

# Attempt to set APP_HOME
# Resolve links: $0 may be a link
PRG="$0"
# Need this for relative symlinks.
while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)

# Create initial migration
echo "ðŸ—„ï¸ Creating initial database migration..."
cat > src/main/resources/db/migration/V1__init_schema.sql << 'EOF'
-- Create schema
CREATE SCHEMA IF NOT EXISTS domain_schema;

-- Create sequences
CREATE SEQUENCE IF NOT EXISTS domain_schema.project_seq START WITH 1 INCREMENT BY 50;
CREATE SEQUENCE IF NOT EXISTS domain_schema.requirement_seq START WITH 1 INCREMENT BY 50;
CREATE SEQUENCE IF NOT EXISTS domain_schema.domain_model_seq START WITH 1 INCREMENT BY 50;

-- Create base tables
CREATE TABLE IF NOT EXISTS domain_schema.projects (
    id BIGINT PRIMARY KEY,
    project_id VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    project_type VARCHAR(50) NOT NULL,
    status VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE INDEX idx_projects_project_id ON domain_schema.projects(project_id);
CREATE INDEX idx_projects_status ON domain_schema.projects(status);
